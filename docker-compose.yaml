# docker-compose.yaml (Final Version with Orchestrator)

services:
  redis:
    image: "redis:alpine"
    networks:
      - bandit-net

  slot-machine-api:
    build:
      context: .
      dockerfile: src/slot_machine_api/Dockerfile
    ports:
      - "8000:8000"
    networks:
      - bandit-net

  rl-agent:
    build:
      context: .
      dockerfile: src/rl_agent/Dockerfile
    deploy:
      replicas: 10
    depends_on:
      - slot-machine-api
      - redis
    networks:
      - bandit-net

  visualizer:
    build:
      context: .
      dockerfile: src/visualizer/Dockerfile
    ports:
      - "5001:5000"
    depends_on:
      - redis
      - slot-machine-api # Visualizer also needs the arm configs now
    networks:
      - bandit-net
  
  # NEW: The Orchestrator Service
  orchestrator:
    build:
      context: .
      dockerfile: src/orchestrator/Dockerfile
    depends_on:
      - rl-agent # Wait for agents to start before monitoring
    networks:
      - bandit-net

networks:
  bandit-net:
    driver: bridge